# 智播农链——作物推荐系统功能设计书

## 项目概述

**项目名称：** 智播农链——从种到销，AI驱动农业全流程数智升级  
**当前实现板块：** 作物推荐系统  
**技术栈：** Streamlit + Python  
**设计风格：** 政务系统风格，SaaS系统，浅绿色主题

## 系统架构

### 核心功能模块
1. **智能微区精细种植管理**
2. **权威算法作物推荐**
3. **数据管理与分析**
4. **用户管理系统**

## 页面功能设计

### 1. 首页/仪表板 (Dashboard)

#### 1.1 功能概述
- 系统总览和关键数据展示
- 快速访问主要功能模块
- 最新推荐结果和系统状态

#### 1.2 页面布局
```
┌─────────────────────────────────────────────────────────┐
│                    智播农链 Logo + 导航栏                 │
├─────────────────────────────────────────────────────────┤
│  系统概览卡片区域                                        │
│  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐ │
│  │ 管理地块数 │ │ 推荐作物数 │ │ 微区数量   │ │ 用户数量  │ │
│  └───────────┘ └───────────┘ └───────────┘ └───────────┘ │
├─────────────────────────────────────────────────────────┤
│  快速功能入口                                            │
│  ┌─────────────────┐ ┌─────────────────┐                │
│  │   地块信息录入   │ │   作物推荐查询   │                │
│  └─────────────────┘ └─────────────────┘                │
├─────────────────────────────────────────────────────────┤
│  最新推荐结果 & 系统通知                                  │
└─────────────────────────────────────────────────────────┘
```

#### 1.3 核心功能
- **数据概览卡片**：显示系统核心指标
- **快速操作按钮**：直接跳转到主要功能
- **最新动态**：显示最近的推荐结果和系统更新
- **天气信息**：当前地区天气状况

### 2. 地块管理页面

#### 2.1 功能概述
- 地块信息录入与管理
- 微区划分和数据采集
- 土壤、气候数据可视化

#### 2.2 页面功能
```
┌─────────────────────────────────────────────────────────┐
│                      地块管理                            │
├─────────────────────────────────────────────────────────┤
│  地块列表                           │   地块详情         │
│  ┌─────────────────────────────┐   │ ┌─────────────────┐ │
│  │ □ 地块A - 面积50亩          │   │ │   地块基本信息   │ │
│  │ □ 地块B - 面积30亩          │   │ │   经纬度：       │ │
│  │ □ 地块C - 面积80亩          │   │ │   面积：         │ │
│  │                            │   │ │   土壤类型：     │ │
│  │ [+添加新地块]              │   │ └─────────────────┘ │
│  └─────────────────────────────┘   │                   │
├─────────────────────────────────────┼───────────────────┤
│  微区划分界面                       │   环境数据监测     │
│  ┌─────────────────────────────┐   │ ┌─────────────────┐ │
│  │     地块可视化地图          │   │ │  盐碱度图表     │ │
│  │   (显示微区边界和传感器)     │   │ │  温湿度趋势     │ │
│  │                            │   │ │  pH值分布       │ │
│  └─────────────────────────────┘   │ │  营养成分       │ │
│                                    │ └─────────────────┘ │
└─────────────────────────────────────┴───────────────────┘
```

#### 2.3 核心功能
- **地块信息录入**：位置、面积、土壤类型等基础信息
- **微区自动划分**：基于遥感数据和传感器数据智能划分
- **环境数据采集**：盐碱度、pH值、温湿度、营养成分等
- **数据可视化**：地图展示、图表分析
- **传感器管理**：设备状态监控和数据同步

### 3. 作物推荐页面

#### 3.1 功能概述
- 基于多维度数据的智能作物推荐
- 收益预测和风险评估
- 个性化推荐方案
- 传感器数据录入与集成

#### 3.2 页面功能
```
┌─────────────────────────────────────────────────────────┐
│                      作物推荐                            │
├─────────────────────────────────────────────────────────┤
│  推荐条件设置                                            │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 地块选择: [下拉选择]  种植季节: [春季▼]              │ │
│  │ 投资预算: [输入框]    风险偏好: [保守/平衡/激进]      │ │
│  │ 目标用途: [食用/饲料/经济作物]                       │ │
│  │ ┌─────────────────────────────────────────────────┐ │ │
│  │ │          传感器数据录入                         │ │ │
│  │ │ 传感器ID: [输入框]    设备类型: [土壤/气象/多合一] │ │ │
│  │ │ 实时数据: [自动获取▼] 手动录入: [手动输入▼]      │ │ │
│  │ │ 温度: [输入框]°C     湿度: [输入框]%             │ │ │
│  │ │ pH值: [输入框]       盐碱度: [输入框]‰           │ │ │
│  │ │ 氮含量: [输入框]mg/kg 磷含量: [输入框]mg/kg      │ │ │
│  │ │ 钾含量: [输入框]mg/kg                          │ │ │
│  │ │ [同步传感器数据] [验证数据] [应用到推荐]         │ │ │
│  │ └─────────────────────────────────────────────────┘ │ │
│  │                           [开始推荐] [重置]          │ │
│  └─────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────┤
│  推荐结果                                               │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │   玉米      │ │    大豆      │ │   向日葵     │        │
│  │ 适应性: ★★★★★│ │ 适应性: ★★★★ │ │ 适应性: ★★★ │        │
│  │ 收益: 高    │ │ 收益: 中高   │ │ 收益: 中     │        │
│  │ 风险: 低    │ │ 风险: 中     │ │ 风险: 中高   │        │
│  │ [详细分析]  │ │ [详细分析]   │ │ [详细分析]   │        │
│  └─────────────┘ └─────────────┘ └─────────────┘        │
├─────────────────────────────────────────────────────────┤
│  微区差异化推荐                                          │
│  ┌─────────────────────────────────────────────────────┐ │
│  │        地块微区分布图                                │ │
│  │  微区1: 玉米    微区2: 大豆    微区3: 向日葵         │ │
│  │  (不同颜色标识不同推荐作物)                          │ │
│  └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

#### 3.3 核心功能
- **智能推荐算法**：整合气候、土壤、市场、专家知识
- **多维度评估**：适应性、收益性、风险性评分
- **微区差异化**：不同微区推荐不同作物
- **收益预测**：种植成本、预期收入、利润分析
- **动态调整**：根据实时数据更新推荐结果
- **传感器集成**：
  - 传感器设备管理和数据同步
  - 实时环境数据获取
  - 手动数据录入和验证
  - 多传感器数据融合分析
  - 数据质量检测和异常预警

### 4. 作物详情分析页面

#### 4.1 功能概述
- 单个作物的详细分析报告
- 种植建议和技术指导
- 市场分析和价格预测

#### 4.2 页面功能
```
┌─────────────────────────────────────────────────────────┐
│                   玉米 - 详细分析                        │
├─────────────────────────────────────────────────────────┤
│  基本信息                           │  适应性分析         │
│  ┌─────────────────────────────┐   │ ┌─────────────────┐ │
│  │ 作物名称：玉米              │   │ │   环境匹配度     │ │
│  │ 推荐品种：郑单958           │   │ │ 土壤适应: 95%   │ │
│  │ 生长周期：120天             │   │ │ 气候适应: 90%   │ │
│  │ 种植难度：★★☆☆☆           │   │ │ 水分需求: 85%   │ │
│  │ 推荐指数：★★★★★           │   │ │ 综合评分: 90%   │ │
│  └─────────────────────────────┘   │ └─────────────────┘ │
├─────────────────────────────────────┼───────────────────┤
│  收益预测                          │  风险评估          │
│  ┌─────────────────────────────┐   │ ┌─────────────────┐ │
│  │ 种植成本：800元/亩          │   │ │ 病虫害风险: 低  │ │
│  │ 预期产量：600公斤/亩        │   │ │ 市场风险: 中    │ │
│  │ 预期收入：1500元/亩         │   │ │ 气候风险: 低    │ │
│  │ 预期利润：700元/亩          │   │ │ 综合风险: 中低  │ │
│  │ 投资回报率：87.5%           │   │ └─────────────────┘ │
│  └─────────────────────────────┘   │                   │
├─────────────────────────────────────┴───────────────────┤
│  种植技术指导                                            │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ • 播种时间：4月中下旬，土壤温度稳定在10°C以上        │ │
│  │ • 播种密度：4000-4500株/亩                          │ │
│  │ • 施肥建议：底肥+追肥，氮磷钾配比控制               │ │
│  │ • 灌溉管理：关键期保证水分供应                      │ │
│  │ • 病虫害防治：重点防治玉米螟、大斑病等              │ │
│  └─────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────┤
│  市场分析                                               │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 当前市场价格：2.5元/公斤 (↑ 5.2%)                   │ │
│  │ 历史价格趋势：[价格走势图]                          │ │
│  │ 供需分析：需求稳定，供应略显不足                    │ │
│  │ 销售建议：建议在收获后1-2个月内销售                 │ │
│  └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

#### 4.3 核心功能
- **综合评估**：适应性、收益性、风险性多维度分析
- **技术指导**：种植技术、田间管理、病虫害防治
- **经济分析**：成本收益分析、投资回报率计算
- **市场情报**：价格走势、供需分析、销售建议
- **专家建议**：基于当地条件的个性化建议

### 5. 数据分析页面

#### 5.1 功能概述
- 历史数据分析和趋势预测
- 多维度数据对比
- 决策支持图表

#### 5.2 页面功能
```
┌─────────────────────────────────────────────────────────┐
│                      数据分析                            │
├─────────────────────────────────────────────────────────┤
│  时间范围选择  [2024年▼] [全年▼]   [应用筛选]            │
├─────────────────────────────────────────────────────────┤
│  环境数据趋势                                            │
│  ┌─────────────────────────────────────────────────────┐ │
│  │                  温度湿度变化趋势图                   │ │
│  │  [折线图显示月度温度、湿度、降雨量变化]               │ │
│  └─────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────┤
│  土壤指标分布                       │  作物表现对比       │
│  ┌─────────────────────────────┐   │ ┌─────────────────┐ │
│  │      盐碱度分布热力图         │   │ │  各作物产量对比  │ │
│  │   (不同颜色代表不同程度)      │   │ │   [柱状图]      │ │
│  │                             │   │ │                 │ │
│  │      pH值分布统计图          │   │ │  收益率对比图   │ │
│  │     [饼图或直方图]           │   │ │   [雷达图]      │ │
│  └─────────────────────────────┘   │ └─────────────────┘ │
├─────────────────────────────────────┼───────────────────┤
│  推荐效果评估                       │  预测模型结果       │
│  ┌─────────────────────────────┐   │ ┌─────────────────┐ │
│  │ 推荐准确率：85%              │   │ │ 下季度最佳作物   │ │
│  │ 农户满意度：92%              │   │ │ 预测：大豆       │ │
│  │ 平均增收：15%                │   │ │ 可信度：87%      │ │
│  │ 风险命中率：8%               │   │ │                 │ │
│  └─────────────────────────────┘   │ └─────────────────┘ │
└─────────────────────────────────────┴───────────────────┘
```

#### 5.3 核心功能
- **环境数据分析**：温湿度、土壤、气候数据趋势
- **作物表现统计**：产量、收益、成功率对比
- **推荐效果评估**：准确率、满意度、增收效果
- **预测分析**：基于历史数据的趋势预测
- **自定义报表**：可导出的数据分析报告

## 技术实现规格

### 前端技术栈
- **主框架**：Streamlit
- **图表库**：Plotly、matplotlib
- **地图组件**：Folium
- **UI组件**：Streamlit原生组件
- **样式设计**：Custom CSS（浅绿色政务风格）

### 数据模拟
- **地块数据**：坐标、面积、土壤类型
- **环境数据**：温湿度、pH值、盐碱度、营养成分
- **作物数据库**：作物信息、适应性参数、市场数据
- **推荐算法**：多因子加权评分模型
- **传感器数据**：多种传感器设备的实时数据接入

### 样式规范
- **主色调**：浅绿色系（#90EE90, #98FB98, #00CED1）
- **辅助色**：白色、深绿色、灰色
- **字体**：微软雅黑、Arial
- **布局**：响应式设计、政务系统风格
- **图标**：农业主题图标集

## 数据结构设计

### 1. 地块数据结构
```python
{
    "plot_id": "P001",
    "name": "示例地块A",
    "area": 50.5,  # 亩
    "location": {
        "latitude": 39.9042,
        "longitude": 116.4074
    },
    "soil_type": "黄壤土",
    "micro_zones": [
        {
            "zone_id": "Z001",
            "area": 12.5,
            "salinity": 0.3,  # 盐碱度
            "ph_value": 6.8,
            "temperature": 18.5,
            "humidity": 65.2,
            "nutrients": {
                "nitrogen": 45.2,
                "phosphorus": 28.1,
                "potassium": 156.8
            }
        }
    ]
}
```

### 2. 作物数据结构
```python
{
    "crop_id": "C001",
    "name": "玉米",
    "variety": "郑单958",
    "category": "谷物",
    "growth_period": 120,  # 天
    "requirements": {
        "temperature_min": 10,
        "temperature_max": 35,
        "ph_min": 6.0,
        "ph_max": 8.0,
        "salinity_tolerance": 0.5,
        "water_requirement": "中等"
    },
    "economics": {
        "cost_per_mu": 800,  # 元/亩
        "yield_per_mu": 600,  # 公斤/亩
        "market_price": 2.5,  # 元/公斤
        "profit_margin": 0.875
    },
    "risk_factors": {
        "disease_risk": "低",
        "pest_risk": "中",
        "market_risk": "中",
        "climate_risk": "低"
    }
}
```

### 3. 传感器数据结构
```python
{
    "sensor_id": "S001",
    "sensor_type": "多合一传感器",
    "plot_id": "P001",
    "zone_id": "Z001",
    "location": {
        "latitude": 39.9042,
        "longitude": 116.4074
    },
    "installation_date": "2024-01-15",
    "status": "在线",
    "current_data": {
        "temperature": 18.5,
        "humidity": 65.2,
        "ph_value": 6.8,
        "salinity": 0.3,
        "nitrogen": 45.2,
        "phosphorus": 28.1,
        "potassium": 156.8,
        "timestamp": "2024-01-15T10:30:00"
    },
    "data_history": [
        {
            "timestamp": "2024-01-15T09:30:00",
            "temperature": 17.8,
            "humidity": 66.1,
            "ph_value": 6.7,
            "salinity": 0.31
        }
    ]
}
```

### 4. 推荐结果数据结构
```python
{
    "recommendation_id": "R001",
    "plot_id": "P001",
    "timestamp": "2024-01-15T10:30:00",
    "sensor_data_used": ["S001", "S002"],  # 使用的传感器数据
    "recommendations": [
        {
            "crop_id": "C001",
            "suitability_score": 95,
            "profit_score": 87,
            "risk_score": 15,
            "overall_score": 89,
            "zone_assignments": ["Z001", "Z002"],
            "reasoning": "基于传感器实时数据，土壤pH值适宜，气候条件良好..."
        }
    ],
    "market_analysis": {
        "current_price": 2.5,
        "price_trend": "上升",
        "demand_forecast": "稳定"
    }
}
```

## 核心算法逻辑

### 作物推荐算法（含传感器数据集成）
```python
def calculate_recommendation_score(crop, zone_data, sensor_data, market_data, weights):
    """
    计算作物推荐得分（集成传感器数据）
    
    参数:
    - crop: 作物数据
    - zone_data: 微区环境数据
    - sensor_data: 传感器实时数据
    - market_data: 市场数据
    - weights: 各因子权重
    
    返回:
    - 综合推荐得分 (0-100)
    """
    
    # 融合传感器数据到环境数据
    enhanced_zone_data = merge_sensor_data(zone_data, sensor_data)
    
    # 环境适应性评分（使用实时传感器数据）
    env_score = calculate_environmental_suitability(crop, enhanced_zone_data)
    
    # 经济效益评分
    profit_score = calculate_profit_potential(crop, market_data)
    
    # 风险评估评分（考虑传感器数据质量）
    risk_score = calculate_risk_assessment(crop, enhanced_zone_data, market_data, sensor_data)
    
    # 技术难度评分
    tech_score = calculate_technical_difficulty(crop)
    
    # 市场前景评分
    market_score = calculate_market_prospects(crop, market_data)
    
    # 数据可靠性评分（基于传感器数据质量）
    reliability_score = calculate_data_reliability(sensor_data)
    
    # 加权计算总分（考虑数据可靠性）
    total_score = (
        env_score * weights['environmental'] +
        profit_score * weights['profit'] +
        (100 - risk_score) * weights['risk'] +
        tech_score * weights['technical'] +
        market_score * weights['market']
    ) * (reliability_score / 100)
    
    return total_score

def merge_sensor_data(zone_data, sensor_data):
    """融合传感器数据到微区数据"""
    if sensor_data and sensor_data.get('current_data'):
        current = sensor_data['current_data']
        zone_data.update({
            'temperature': current.get('temperature', zone_data.get('temperature')),
            'humidity': current.get('humidity', zone_data.get('humidity')),
            'ph_value': current.get('ph_value', zone_data.get('ph_value')),
            'salinity': current.get('salinity', zone_data.get('salinity')),
            'nutrients': {
                'nitrogen': current.get('nitrogen', zone_data.get('nutrients', {}).get('nitrogen')),
                'phosphorus': current.get('phosphorus', zone_data.get('nutrients', {}).get('phosphorus')),
                'potassium': current.get('potassium', zone_data.get('nutrients', {}).get('potassium'))
            }
        })
    return zone_data

def calculate_data_reliability(sensor_data):
    """计算传感器数据可靠性得分"""
    if not sensor_data:
        return 50  # 无传感器数据时的基础可靠性
    
    reliability = 100
    current = sensor_data.get('current_data', {})
    
    # 检查数据完整性
    required_fields = ['temperature', 'humidity', 'ph_value', 'salinity']
    missing_fields = [field for field in required_fields if field not in current]
    reliability -= len(missing_fields) * 10
    
    # 检查数据时效性
    timestamp = current.get('timestamp')
    if timestamp:
        from datetime import datetime, timedelta
        data_time = datetime.fromisoformat(timestamp.replace('Z', '+00:00'))
        if datetime.now() - data_time > timedelta(hours=24):
            reliability -= 20
    
    # 检查传感器状态
    if sensor_data.get('status') != '在线':
        reliability -= 30
    
    return max(0, min(100, reliability))
```

这个功能设计书现在包含了完整的传感器数据集成功能，并删除了系统设置页面，重点突出了作物推荐系统的核心功能。传感器功能的添加使得推荐系统能够基于实时环境数据提供更准确的作物推荐。 